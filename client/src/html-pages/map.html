<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>

  <!--  MapBox -->
  <script src='https://api.mapbox.com/mapbox-gl-js/v1.8.1/mapbox-gl.js'></script>
  <link href='https://api.mapbox.com/mapbox-gl-js/v1.8.1/mapbox-gl.css' rel='stylesheet' />
</head>
<body>
  <div id="map" style='width: 300px; height: 400px;'></div>
  <script src='https://unpkg.com/es6-promise@4.2.4/dist/es6-promise.auto.min.js'></script>
  <script src="https://unpkg.com/@mapbox/mapbox-sdk/umd/mapbox-sdk.min.js"></script>
  <script>
    // mapboxgl.accessToken = 'pk.eyJ1IjoiaGF3aW0iLCJhIjoiY2szaTl3OGI4MDYybDNtcnZhb2Z0cWhtYSJ9.7LOPYP3D6EDcC1KOKzOpyw';
    // var map = new mapboxgl.Map({
    //   container: 'map',
    //   style: 'mapbox://styles/mapbox/streets-v11'
    // });

    mapboxgl.accessToken = 'pk.eyJ1IjoiaGF3aW0iLCJhIjoiY2szaTl3OGI4MDYybDNtcnZhb2Z0cWhtYSJ9.7LOPYP3D6EDcC1KOKzOpyw';
    getGeoCode('Vancouver').then(geoCode => setupMap(geoCode));


    function setupMap(geoCode) {
      // Define the map and configure the map's theme
      let map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/streets-v11',
        zoom: 14,
        minZoom: 11,
        maxZoom: 17,
        maxBounds:[[-123.3845691633, 48.9221301735], [-122.5163910206, 49.486393603]], // [left, bottom], [right, top]
        center: [geoCode[0], geoCode[1]]
      });

      // Add Navigation controls to the map to the top-right corner of the map
      let nav = new mapboxgl.NavigationControl();
      map.addControl(nav, 'top-right');

      // Add a Scale to the map
      map.addControl(new mapboxgl.ScaleControl({
        maxWidth: 80,
        unit: 'metric'
      }));

      return map;
    }

    // Get geocode using Mapbox API
    function getGeoCode(query) {
      let mapboxClient = mapboxSdk({ accessToken: mapboxgl.accessToken });

      // Query to Mapbox API
      return mapboxClient.geocoding.forwardGeocode({
        query: query,
        autocomplete: false,
        limit: 1,
        bbox: [-123.3845691633, 48.9221301735, -122.5163910206, 49.486393603], // Inside Lower Mainland area
      }).send().then(res => {
        // Check for match
        if (res.body.features.hasOwnProperty("0")) {
          return res.body.features[0].center
        }
        else { // Search query could not be found
          showErrorPage();
        }
      });
    }

    function showErrorPage() {
      let map = document.getElementById("map");
      let error = document.createElement("div");
      error.className = "row h-100 text-white text-center align-items-center";
      error.style = "font-size: 3rem;"
      error.innerHTML = "We could not find pet services near that location.<br> Please try again.";
      map.className = "container-fluid d-flex justify-content-center";
      map.appendChild(error);
    }
  </script>
</body>
</html>